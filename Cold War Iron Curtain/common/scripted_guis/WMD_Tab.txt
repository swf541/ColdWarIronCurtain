scripted_gui = {
	midnight_tension_button = {
		context_type = player_context

		window_name = "midnight_tension"
		parent_window_name = "topbar"

		visible = {
			threat > 0.99
		}
	}

	WMD_tab_menu = {
		context_type = player_context
		dirty = refresh_wmd_menu
		window_name = "WMD_tab"

		visible = {
			check_variable = { show_wmd = 1 }
		}	
		triggers = {
			defconbutton_raise_click_enabled = {
				if = { limit = { has_idea = defcon_system_5 }
					custom_trigger_tooltip = {
						tooltip = highest_defcon_TT
						NOT = { has_idea = defcon_system_5 }
					}
				}
				custom_trigger_tooltip = {
					tooltip = DEFCON_cooldown_TT
					NOT = { check_variable = { DEFCON_cooldown = 1 } }
				}
				custom_trigger_tooltip = {
					tooltip = has_nukes_TT
					check_variable = { num_of_nukes > 0 }
				}
			}

			defconbutton_lower_click_enabled = {
				if = { limit = { has_idea = defcon_system_1 }
					custom_trigger_tooltip = {
						tooltip = lowest_defcon_TT
						NOT = { has_idea = defcon_system_1 }
					}
				}
				custom_trigger_tooltip = {
					tooltip = DEFCON_cooldown_TT
					NOT = { check_variable = { DEFCON_cooldown = 1 } }
				}
				custom_trigger_tooltip = {
					tooltip = has_nukes_TT
					check_variable = { num_of_nukes > 0 }
				}
				if = { limit = { has_idea = defcon_system_5 }
					custom_trigger_tooltip = {
						tooltip = needs_60_WT_TT
						threat > 0.6
					}
				}
				else_if = { limit = { has_idea = defcon_system_4 }
					custom_trigger_tooltip = {
						tooltip = needs_80_WT_TT
						threat > 0.8
					}
				}
				else_if = { limit = { has_idea = defcon_system_3 }
					custom_trigger_tooltip = {
						tooltip = needs_90_WT_TT
						threat > 0.9
					}
				}
				else_if = { limit = { has_idea = defcon_system_2 }
					custom_trigger_tooltip = {
						tooltip = needs_100_WT_TT
						threat > 0.999
					}
				}
			}

			wmd_defcon_1_visible = {
				has_idea = defcon_system_1
			}
			wmd_defcon_2_visible = {
				has_idea = defcon_system_2
			}
			wmd_defcon_3_visible = {
				has_idea = defcon_system_3
			}
			wmd_defcon_4_visible = {
				has_idea = defcon_system_4
			}
			wmd_defcon_5_visible = {
				has_idea = defcon_system_5
			}
			wmd_defcon_none_visible = {
				NOT = {
					has_idea = defcon_system_1
					has_idea = defcon_system_2
					has_idea = defcon_system_3
					has_idea = defcon_system_4
					has_idea = defcon_system_5
				}
			}
			wmd_authorize_click_enabled = { check_variable = { ack_authorize = 0 } }
			WMD_Key_Right_0_visible = { check_variable = { key_turned = 0 } }
			WMD_Key_Right_1_visible = { check_variable = { key_turned = 1 } }
			WMD_Key_Right_2_visible = { check_variable = { key_turned = 2 } }
			WMD_Key_Left_0_visible = { check_variable = { left_key_turned = 0 } }
			WMD_Key_Left_1_visible = { check_variable = { left_key_turned = 1 } }
			WMD_Key_Left_2_visible = { check_variable = { left_key_turned = 2 } }
		}

		effects = {
			defconbutton_raise_click = {
				if = { limit = {  has_idea = defcon_system_1 }
					log = "defcon 1 to 2"
					remove_ideas = defcon_system_1
					add_ideas = defcon_system_2
				}
				else_if = { limit = { has_idea = defcon_system_2 }
					log = "defcon 2 to 3"
					remove_ideas = defcon_system_2
					add_ideas = defcon_system_3				
				}
				else_if = { limit = { has_idea = defcon_system_3 }
					log = "defcon 3 to 4"
					remove_ideas = defcon_system_3
					add_ideas = defcon_system_4			
				}
				else_if = { limit = { has_idea = defcon_system_4 }
					log = "defcon 4 to 5"
					remove_ideas = defcon_system_4
					add_ideas = defcon_system_5			
				}				
				else = {
					log = "raise defcon fail"
				}	
				#add_timed_idea = {
				#	idea = DEFCON_COOLDOWN
				#	days = 2
				#}	

				set_variable = { DEFCON_cooldown = 1}
				add_to_variable = { refresh_wmd_menu = 1}

				THIS = {
					activate_mission = WMD_defcon_cooldown
				}
			}

			defconbutton_lower_click = {
				if = { limit = { has_idea = defcon_system_5 }
					log = "defcon 5 to 4"
					remove_ideas = defcon_system_5
					add_ideas = defcon_system_4
				}
				else_if = {  limit = { has_idea = defcon_system_4 }
					log = "defcon 4 to 3"
					remove_ideas = defcon_system_4
					add_ideas = defcon_system_3				
				}
				else_if = { limit = { has_idea = defcon_system_3 }
					log = "defcon 3 to 2"
					remove_ideas = defcon_system_3
					add_ideas = defcon_system_2			
				}
				else_if = { limit = { has_idea = defcon_system_2 }
					log = "defcon 2 to 1"
					remove_ideas = defcon_system_2
					add_ideas = defcon_system_1			
				}				
				else = {
					log = "defcon none to 5"
					add_ideas = defcon_system_5
				}
				#add_timed_idea = {
				#	idea = DEFCON_COOLDOWN
				#	days = 2
				#}	

				set_variable = { DEFCON_cooldown = 1}
				add_to_variable = { refresh_wmd_menu = 1}	

				THIS = {
					activate_mission = WMD_defcon_cooldown
				}
			}

			wmd_reset_click = {
				ROOT = {
					add_to_variable = {refresh_wmd_menu = 1}

					set_variable = { tier_1_selected = 0 }
					set_variable = { tier_2_selected = 0 }
					set_variable = { tier_3_selected = 0 }
					set_variable = { target_selected = 0 }
					#set_variable = { show_super_event_korea_nuke = 1 }
					set_variable = { key_hanging_selected = 0 }
					set_variable = { key_turned = 0}
					set_variable = { left_key_turned = 0}
					set_variable = { ack_selected = 0 }
					set_variable = { ack_authorize = 0 }
					set_variable = { activation_code = 0 }
					set_variable = { missile_selected = 0 }
					set_variable = { right_display = 1 }

					clear_array = ROOT.nuclear_power_custom_array
					every_country = {
						limit = { check_variable = { num_of_nukes > 0 } }
						add_to_array = { ROOT.nuclear_power_custom_array = THIS.id }
					}
				}		
				wmd_stockpile_loc = yes
				nuclear_power_array = yes
			}

			wmd_authorize_click = {
				set_variable = { ack_authorize = 1 }
				add_to_variable = { ack_selected = 0.50 }
				set_variable = { activation_code = 1 }

				#random_code_generator
				set_variable = { authorization_code_bit_1 = random }
				multiply_variable = { authorization_code_bit_1 = 100 }
				round_variable = authorization_code_bit_1

				set_variable = { authorization_code_bit_2 = random }
				multiply_variable = { authorization_code_bit_2 = 100 }
				round_variable = authorization_code_bit_2

				set_variable = { authorization_code_bit_3 = random }
				multiply_variable = { authorization_code_bit_3 = 100 }
				round_variable = authorization_code_bit_3

				set_variable = { authorization_code_bit_4 = random }
				multiply_variable = { authorization_code_bit_4 = 100 }
				round_variable = authorization_code_bit_4

				set_variable = { authorization_code_bit_5 = random }
				multiply_variable = { authorization_code_bit_5 = 100 }
				round_variable = authorization_code_bit_5

				set_variable = { authorization_code_bit_6 = random }
				multiply_variable = { authorization_code_bit_6 = 100 }
				round_variable = authorization_code_bit_6

				set_variable = { authorization_code_bit_7 = random }
				multiply_variable = { authorization_code_bit_7 = 100 }
				round_variable = authorization_code_bit_7

				set_variable = { authorization_code_bit_8 = random }
				multiply_variable = { authorization_code_bit_8 = 100 }
				round_variable = authorization_code_bit_8

				set_variable = { authorization_code_bit_9 = random }
				multiply_variable = { authorization_code_bit_9 = 100 }
				round_variable = authorization_code_bit_9

				set_variable = { authorization_code_bit_10 = random }
				multiply_variable = { authorization_code_bit_10 = 100 }
				round_variable = authorization_code_bit_11

				set_variable = { authorization_code_bit_12 = random }
				multiply_variable = { authorization_code_bit_13 = 100 }
				round_variable = authorization_code_bit_13

				set_variable = { authorization_code_bit_14 = random }
				multiply_variable = { authorization_code_bit_14 = 100 }
				round_variable = authorization_code_bit_14
			
				set_variable = { authorization_code_bit_15 = random }
				multiply_variable = { authorization_code_bit_15 = 100 }
				round_variable = authorization_code_bit_15

				set_variable = { authorization_code_bit_16 = random }
				multiply_variable = { authorization_code_bit_16 = 100 }
				round_variable = authorization_code_bit_16

				set_variable = { authorization_code_bit_17 = random }
				multiply_variable = { authorization_code_bit_17 = 100 }
				round_variable = authorization_code_bit_17

				set_variable = { authorization_code_bit_18 = random }
				multiply_variable = { authorization_code_bit_18 = 100 }
				round_variable = authorization_code_bit_18

				set_variable = { authorization_code_bit_19 = random }
				multiply_variable = { authorization_code_bit_19 = 100 }
				round_variable = authorization_code_bit_19

				set_variable = { authorization_code_bit_20 = random }
				multiply_variable = { authorization_code_bit_20 = 100 }
				round_variable = authorization_code_bit_20

				set_variable = { authorization_code_bit_21 = random }
				multiply_variable = { authorization_code_bit_21 = 100 }
				round_variable = authorization_code_bit_21

				set_variable = { authorization_code_bit_22 = random }
				multiply_variable = { authorization_code_bit_22 = 100 }
				round_variable = authorization_code_bit_22

				set_variable = { authorization_code_bit_23 = random }
				multiply_variable = { authorization_code_bit_23 = 100 }
				round_variable = authorization_code_bit_23

				set_variable = { authorization_code_bit_24 = random }
				multiply_variable = { authorization_code_bit_24 = 100 }
				round_variable = authorization_code_bit_24

				set_variable = { authorization_code_bit_25 = random }
				multiply_variable = { authorization_code_bit_25 = 100 }
				round_variable = authorization_code_bit_25

				set_variable = { authorization_code_bit_26 = random }
				multiply_variable = { authorization_code_bit_26 = 100 }
				round_variable = authorization_code_bit_26

				set_variable = { authorization_code_bit_27 = random }
				multiply_variable = { authorization_code_bit_27 = 100 }
				round_variable = authorization_code_bit_27

				set_variable = { authorization_code_bit_28 = random }
				multiply_variable = { authorization_code_bit_28 = 100 }
				round_variable = authorization_code_bit_28

				set_variable = { authorization_code_bit_29 = random }
				multiply_variable = { authorization_code_bit_29 = 100 }
				round_variable = authorization_code_bit_29

				set_variable = { authorization_code_bit_30 = random }
				multiply_variable = { authorization_code_bit_30 = 100 }
				round_variable = authorization_code_bit_30

				set_variable = { authorization_code_bit_31 = random }
				multiply_variable = { authorization_code_bit_31 = 100 }
				round_variable = authorization_code_bit_31

				set_variable = { authorization_code_bit_32 = random }
				multiply_variable = { authorization_code_bit_32 = 100 }
				round_variable = authorization_code_bit_32

				add_to_variable = {refresh_wmd_menu = 1}
			}

			WMD_Key_Right_1_click = {
				if = { limit = { check_variable = { key_turned = 0 } }
					set_variable = { key_turned = 1 }
					add_to_variable = { ack_selected = 0.125 }
				}
				else_if = { limit = { check_variable = { key_turned = 1 } }
					set_variable = { key_turned = 2 }
					add_to_variable = { ack_selected = 0.125 }						
				}
				else = {
					set_variable = { key_turned = 0 }
					subtract_from_variable = { ack_selected = 0.25 }
				}
				add_to_variable = {refresh_wmd_menu = 1}
			}

			WMD_Key_Right_2_click = {
				if = { limit = { check_variable = { key_turned = 0 } }
					set_variable = { key_turned = 1 }
					add_to_variable = { ack_selected = 0.125 }
				}
				else_if = { limit = { check_variable = { key_turned = 1 } }
					set_variable = { key_turned = 2 }
					add_to_variable = { ack_selected = 0.125 }						
				}
				else = {
					set_variable = { key_turned = 0 }
					subtract_from_variable = { ack_selected = 0.250 }

				}
				add_to_variable = {refresh_wmd_menu = 1}
			}

			WMD_Key_Right_0_click = {
				if = { limit = { check_variable = { key_turned = 0 } }
					set_variable = { key_turned = 1 }
					add_to_variable = { ack_selected = 0.125 }
				}
				else_if = { limit = { check_variable = { key_turned = 1 } }
					set_variable = { key_turned = 2 }
					add_to_variable = { ack_selected = 0.125 }						
				}
				else = {
					set_variable = { key_turned = 0 }
					subtract_from_variable = { ack_selected = 0.250 }
				}
				add_to_variable = {refresh_wmd_menu = 1}
			}

			WMD_Key_Left_1_click = {
				if = { limit = { check_variable = { left_key_turned = 0 } }
					set_variable = { left_key_turned = 1 }
					add_to_variable = { ack_selected = 0.125 }
				}
				else_if = { limit = { check_variable = { left_key_turned = 1 } }
					set_variable = { left_key_turned = 2 }
					add_to_variable = { ack_selected = 0.125 }						
				}
				else = {
					set_variable = { left_key_turned = 0 }
					subtract_from_variable = { ack_selected = 0.25 }
				}
				add_to_variable = {refresh_wmd_menu = 1}
			}

			WMD_Key_Left_2_click = {
				if = { limit = { check_variable = { left_key_turned = 0 } }
					set_variable = { left_key_turned = 1 }
					add_to_variable = { ack_selected = 0.125 }
				}
				else_if = { limit = { check_variable = { left_key_turned = 1 } }
					set_variable = { left_key_turned = 2 }
					add_to_variable = { ack_selected = 0.125 }						
				}
				else = {
					set_variable = { left_key_turned = 0 }
					subtract_from_variable = { ack_selected = 0.25 }
				}
				add_to_variable = {refresh_wmd_menu = 1}
			}

			WMD_Key_Left_0_click = {
				if = { limit = { check_variable = { left_key_turned = 0 } }
					set_variable = { left_key_turned = 1 }
					add_to_variable = { ack_selected = 0.125 }
				}
				else_if = { limit = { check_variable = { left_key_turned = 1 } }
					set_variable = { left_key_turned = 2 }
					add_to_variable = { ack_selected = 0.125 }						
				}
				else = {
					set_variable = { left_key_turned = 0 }
					subtract_from_variable = { ack_selected = 0.25 }
				}
				add_to_variable = {refresh_wmd_menu = 1}
			}

			exitbutton_wmd_click = {
				ROOT = {
					set_temp_variable = { show = 1 }
					subtract_from_temp_variable = { show = show_wmd }
					set_variable = { show_wmd = show }
				}			
			}

			show_nuclear_powers_click = {
				ROOT = {
					if = { limit = { check_variable = { right_display = 1 }  }					
						set_variable = { right_display = 2 }
					}
					else_if = { limit = { check_variable = { right_display = 2 } }
						set_variable = { right_display = 1 }
					}
				}	
				add_to_variable = { refresh_wmd_menu = 1}		
			}

			denuclearize_click = {
				set_temp_variable = { NukesRemoval = NukeTotal }
				multiply_temp_variable = { NukesRemoval = -1 }
				
				add_nuclear_bombs = var:NukesRemoval
			}

			denuclearize1_click = {
				set_temp_variable = { MustardGasRemoval = MustardGasTotal }
				multiply_temp_variable = { MustardGasRemoval = -1 }

				meta_effect = {
					text = {
						add_equipment_to_stockpile = {
							type = chemical_weapons_1
							amount = [REMOVE_MUSTARD]
						}
					}
					REMOVE_MUSTARD = "[?MustardGasRemoval|0]"
				}

				#2
				set_temp_variable = { NapalmRemoval = NapalmTotal }
				multiply_temp_variable = { NapalmRemoval = -1 }
				meta_effect = {
					text = {
						add_equipment_to_stockpile = {
							type = napalm_1
							amount = [REMOVE_NAPALM]
						}
					}
					REMOVE_NAPALM = "[?NapalmRemoval|0]"
				}

				#3
				set_temp_variable = { SarinRemoval = SarinTotal }
				multiply_temp_variable = { SarinRemoval = -1 }
				meta_effect = {
					text = {
						add_equipment_to_stockpile = {
							type = sarin_1
							amount = [REMOVE_SARIN]
						}

					}
					REMOVE_SARIN = "[?SarinRemoval|0]"
				}

				#4
				set_temp_variable = { VXRemoval = VXTotal }
				multiply_temp_variable = { VXRemoval = -1 }
				meta_effect = {
					text = {
						add_equipment_to_stockpile = {
							type = vx_1
							amount = [REMOVE_VX]
						}
					}
					REMOVE_VX = "[?VXRemoval|0]"
				}				
			}

			denuclearize2_click = {
			}

			hanging_key1_click = {
				if = { limit = { check_variable = { key_hanging_selected = 0 } }
					set_variable = { key_hanging_selected = 1 }
					set_variable = { key_turned = 1 }
				}
				else = {
					set_variable = { key_hanging_selected = 0 }
					set_variable = { key_turned = 0 }
				}
				add_to_variable = {refresh_wmd_menu = 1}
			}
		}
	}

	wmd_topbar_button = {
		context_type = player_context

		window_name = "wmd_topbar_button"
		parent_window_name = "after_intel_agency_button"
		effects = {
			wmd_tab_open_click = {
				ROOT = {
					set_temp_variable = { show = 1 }
					subtract_from_temp_variable = { show = show_wmd }
					close_all_windows = yes
					set_variable = { show_wmd = show }

					set_variable = { tier_1_selected = 0 }
					set_variable = { tier_2_selected = 0 }
					set_variable = { tier_3_selected = 0 }
					set_variable = { target_selected = 0 }

					#set_variable = { show_super_event_korea_nuke = 1 }
					set_variable = { key_hanging_selected = 0 }
					set_variable = { key_turned = 0}
					set_variable = { left_key_turned = 0}
					set_variable = { ack_selected = 0 }
					set_variable = { ack_authorize = 0 }
					set_variable = { activation_code = 0 }
					set_variable = { missile_selected = 0 }
					set_variable = { right_display = 1 }

					clear_array = ROOT.nuclear_power_custom_array
					every_country = {
						limit = { check_variable = { num_of_nukes > 0 } }
						add_to_array = { ROOT.nuclear_power_custom_array = THIS.id }
					}
				}		
				wmd_stockpile_loc = yes
				nuclear_power_array = yes
			}	
		}
	}

	#wmd_nuclear_powers_list = {
    #    context_type = player_context
    #    window_name = "wmd_list"
	#	parent_window_name = WMD_tab
    #     dynamic_lists = {
    #        nuclear_power_listing_grid = {
    #            array = ROOT.nuclear_power_custom_array
    #            change_scope = yes
	#			entry_container = nuclear_power_listing_entry
    #        }
    #    }
    #}

	


	######################################
	# nuclear powers list

	wmd_nuclear_powers_list = {
        context_type = player_context
        window_name = "wmd_nuclear_powers_list"
		parent_window_name = WMD_tab

        dynamic_lists = {
            wmd_nuclear_powers_listing_grid = {
                array = ROOT.nuclear_power_custom_array
                change_scope = yes
				entry_container = wmd_nuclear_powers_listing_entry
            }
        }

		properties = {
			flag = {
				image = "[This.GetFlag]"
			}
		}
    }

	###################################

	# WMD STOCKPILE LIST

	wmd_stockpile_list = {
		context_type = player_context
        window_name = "wmd_mid_portion"
		parent_window_name = WMD_tab
	}
	
	wmd_bottom = {
        context_type = player_context
        window_name = "wmd_bottom_portion"
		parent_window_name = WMD_tab

		triggers = {
			authorization_code_visible = {
				check_variable = {
					ack_authorize = 1
				}				
			}

			authorization_code_two_visible = {
				check_variable = {
					ack_authorize = 1
				}
			}

			wmd_button_launch_off_visible = {
				OR = {
					has_equipment = {
						icbm_equipment < var:warhead_cost
					}

					num_of_nukes < var:nuke_cost

					check_variable = { ROOT.nations_selected < 0 }

					check_variable = { missile_selected = 0 }
					check_variable = { target_selected = 0 }
					check_variable = { ack_selected = 0 }
					AND = {
						check_variable = { tier_1_selected = 0 }
						check_variable = { tier_2_selected = 0 }
						check_variable = { tier_3_selected = 0 }
					}
				}
			}

			wmd_button_launch_visible = {
				
				has_equipment = {
					icbm_equipment > var:warhead_cost
				}

				num_of_nukes > var:nuke_cost

				check_variable = { ROOT.nations_selected > 0 }

				check_variable = { missile_selected = 1 }
				check_variable = { target_selected = 1 }
				check_variable = { ack_selected = 1 }

				OR = {
					check_variable = { tier_1_selected = 1 }
					check_variable = { tier_2_selected = 1 }
					check_variable = { tier_3_selected = 1 }
				}
			}
		}

		properties = {
			tier1={
				image = "[tier_1_icon]"
			}
			tier2={
				image = "[tier_2_icon]"
			}
			tier3={
				image = "[tier_3_icon]"
			}
			target_icon={
				image = "[target_status]"
			}
			missile_icon={
				image = "[missile_status]"
			}
			ack_icon={
				image = "[ack_status]"
			}
		}

		effects = {
			tier1_click = { 
				distance_calculator_tier_1 = yes

				## check for missiles and nukes
				if = {
					limit = {
						OR = {
							check_variable = { IcbmTotal > 0 }
							check_variable = { IRBMTotal > 0 }
							check_variable = { SLBMTotal > 0 }
						}
						check_variable = { NukeTotal > 0 }
					}
					set_variable = { missile_selected = 1}
				}
				else = {
					set_variable = { missile_selected = 0}
				}

				###############################################

				if = {
					limit = {
						check_variable = { tier_1_selected = 0 }
					}
					set_variable = { tier_1_selected = 1 }
					set_variable = { tier_2_selected = 0 }
					set_variable = { tier_3_selected = 0 }

					set_variable = { target_selected = 1}
				}
				else_if = {
					limit = {
						check_variable = { tier_1_selected = 1 }
					}
					set_variable = { tier_1_selected = 0 }

					set_variable = { target_selected = 0}
					set_variable = { missile_selected = 0}
				}
				
				####################

				set_country_flag = WMD_STRIKE_LEVEL_1
				clr_country_flag = WMD_STRIKE_LEVEL_2
				clr_country_flag = WMD_STRIKE_LEVEL_3

				add_to_variable = {refresh_wmd_menu = 1}
			}

			tier2_click = { 
				distance_calculator_tier_2 = yes

				## check for missiles and nukes
				if = {
					limit = {
						OR = {
							check_variable = { IcbmTotal > 0 }
							check_variable = { IRBMTotal > 0 }
							check_variable = { SLBMTotal > 0 }
						}
						check_variable = { NukeTotal > 0 }
					}
					set_variable = { missile_selected = 1}
				}

				###############################################

				if = {
					limit = {
						check_variable = { tier_2_selected = 0 }
					}
					set_variable = { tier_1_selected = 0 }
					set_variable = { tier_2_selected = 1 }
					set_variable = { tier_3_selected = 0 }

					set_variable = { target_selected = 1 }
				}
				else_if = {
					limit = {
						check_variable = { tier_2_selected = 1 }
					}
					set_variable = { tier_2_selected = 0 }
					set_variable = { target_selected = 0 }
					set_variable = { missile_selected = 0 }
				}
				else = {
					set_variable = { missile_selected = 0 }
				}
				####################

				set_country_flag = WMD_STRIKE_LEVEL_2
				clr_country_flag = WMD_STRIKE_LEVEL_1
				clr_country_flag = WMD_STRIKE_LEVEL_3

				add_to_variable = {refresh_wmd_menu = 1}
			}

			tier3_click = { 
				distance_calculator = yes
				if = {
					limit = {
						check_variable = { tier_3_selected = 0 }
					}
					set_variable = { tier_1_selected = 0 }
					set_variable = { tier_2_selected = 0 }
					set_variable = { tier_3_selected = 1 }

					set_variable = { target_selected = 1 }
				}
				else_if = {
					limit = {
						check_variable = { tier_3_selected = 1 }
					}
					set_variable = { tier_3_selected = 0 }
					set_variable = { target_selected = 0 }
					set_variable = { missile_selected = 0 }
				}

				###############################################

				set_country_flag = WMD_STRIKE_LEVEL_3
				clr_country_flag = WMD_STRIKE_LEVEL_2
				clr_country_flag = WMD_STRIKE_LEVEL_1
				
				add_to_variable = {refresh_wmd_menu = 1}
			}

			wmd_button_launch_click = { 
				for_each_loop = {
					array = WarCrimeTargetList
					launch_nuke = {
						state = var:WarCrimeTargetList^i
						use_nuke = yes
					}
					multiply_variable = { warhead_damage_local = ROOT.warhead_damage }
					for_loop_effect = {
						start = 0
						end = warhead_damage
						
						wmd_damage_loop_effect = yes
					}
					set_variable = { warhead_damage_local = 0 }
				}
				set_variable = { icbm_cost = warhead_cost }
				multiply_variable = { icbm_cost = -1 }

				meta_effect = {
					text = {
						add_equipment_to_stockpile = {
							type = icbm_equipment
							amount = [AMNT]
						}
					}
					AMNT = "icbm_cost"
				}

				###################################################
				# MAD

				#USA triggered MAD
				if = {
					limit = {
						ROOT = {
							check_variable = { THIS.id = USA.id }
							check_variable = { tier_3_selected = 1 }
							OR = {
								SOV = {
									check_variable = { THIS.checkmark = 1 }
								}
								POL = {
									check_variable = { THIS.checkmark = 1 }
								}
								CZE = {
									check_variable = { THIS.checkmark = 1 }
								}
								HUN = {
									check_variable = { THIS.checkmark = 1 }
								}
								ALB = {
									check_variable = { THIS.checkmark = 1 }
								}
								ROM = {
									check_variable = { THIS.checkmark = 1 }
								}
								BUL= {
									check_variable = { THIS.checkmark = 1 }
								}
								#SOV = {
								#	check_variable = { THIS.checkmark = 1 }
								#}
							}
						}
					}

					#add_to_variable = { VTC.usa_global_thermonuclearwar = 1 }

					################################################
					# draw striking array/ NATO

					clear_array = SOV.COUNTERATTACK

					#SOV = {

						every_state = {
							limit = {
								#Is owned by an enemy country
								any_country = {
									controls_state = PREV
									has_war_with = SOV
								}
							}
							if = {
								limit = {
									NOT = {
										is_in_array = {
										array = SOV.COUNTERATTACK
										value = THIS.id
										}
									}
									OR = {
										is_capital = yes
										state_population_k > 4000
										#controller = {
										#	divisions_in_state = {
										#		size > 4
										#		state = PREV
										#	}
										#}

										#nuclear_reactor > 0
									}
								}
								add_to_array = { SOV.COUNTERATTACK = THIS.id }

								add_to_variable = { SOV.COUNTERATTACK_warhead_cost = 1 }

								set_variable = { state_pop_total = state_population_k }
								if = {
									limit = {
										check_variable = { state_pop_total > 1000 }
									}
									divide_variable = { state_pop_total = 1000 }
									round_variable = state_pop_total
									add_to_variable = { SOV.COUNTERATTACK_warhead_cost = state_pop_total }
								}
							}
						}
					#}

					#event
					every_country = {
						#limit = {
						#	is_ai = no
						#}
						if = {
							limit = {
								tag = SOV
							}
							country_event = WMD.2
							news_event = WMD.31
						}
						else = {
							news_event = WMD.31
						}
					}

					if = {
						limit = {
							SOV = {
								is_ai = yes
							}
						}
						SOV = {
							activate_mission = WMD_USA_MAD
						}
						#every_country = {
						#	limit = {
						#		is_ai = no
						#	}
							#news_event = UN_RESOLUTION.1
						#}
					}
				}

				#event
				#if = {
				#	limit = {
				#		check_variable = { VTC.usa_global_thermonuclearwar = 1 }
				#	}
					
				#}

				#SOV triggered MAD
				if = {
					limit = {
						ROOT = {
							check_variable = { THIS.id = SOV.id }
							check_variable = { tier_3_selected = 1 }
							OR = {
								USA= {
									check_variable = { THIS.checkmark = 1 }
								}
								WGR= {
									check_variable = { THIS.checkmark = 1 }
								}
								DEN = {
									check_variable = { THIS.checkmark = 1 }
								}
								ENG = {
									check_variable = { THIS.checkmark = 1 }
								}
								HOL = {
									check_variable = { THIS.checkmark = 1 }
								}
								BEL = {
									check_variable = { THIS.checkmark = 1 }
								}
								FRA = {
									check_variable = { THIS.checkmark = 1 }
								}
								ITA= {
									check_variable = { THIS.checkmark = 1 }
								}
								#SOV = {
								#	check_variable = { THIS.checkmark = 1 }
								#}
							}
						}
					}

					#add_to_variable = { VTC.sov_global_thermonuclearwar = 1 }

					################################################
					# draw striking array/ USSR

					clear_array = USA.COUNTERATTACK

					#USA = {

						every_state = {
							limit = {
								#Is owned by an enemy country
								any_country = {
									controls_state = PREV
									has_war_with = USA
								}
							}
							if = {
								limit = {
									NOT = {
										is_in_array = {
										array = USA.COUNTERATTACK
										value = THIS.id
										}
									}
									OR = {
										is_capital = yes
										state_population_k > 4000
										
										#controller = {
										#	divisions_in_state = {
										#		size > 4
										#		state = PREV
										#	}
										#}

										#nuclear_reactor > 0
									}
								}
								add_to_array = { USA.COUNTERATTACK = THIS.id }

								add_to_variable = { USA.COUNTERATTACK_warhead_cost = 1 }

								set_variable = { state_pop_total = state_population_k }
								if = {
									limit = {
										check_variable = { state_pop_total > 1000 }
									}
									divide_variable = { state_pop_total = 1000 }
									round_variable = state_pop_total
									add_to_variable = { USA.COUNTERATTACK_warhead_cost = state_pop_total }
								}
							}
						}
					#}

					#event
					every_country = {
						#limit = {
						#	is_ai = no
						#}
						if = {
							limit = {
								tag = USA
							}
							country_event = WMD.1
							news_event = WMD.3
						}
						else = {
							news_event = WMD.3
						}
					}

					if = {
						limit = {
							USA = {
								is_ai = yes
							}
						}
						USA = {
							activate_mission = WMD_SOV_MAD
						}
						#every_country = {
						#	limit = {
						#		is_ai = no
						#	}
						#
						#	#news_event = UN_RESOLUTION.1
						#
						#}
					}
				}

				#event
				#if = {
				#	limit = {
				#		check_variable = { VTC.sov_global_thermonuclearwar = 1 }
				#	}					
				#	
				#}

				set_variable = { tier_1_selected = 0 }
				set_variable = { tier_2_selected = 0 }
				set_variable = { tier_3_selected = 0 }

				set_variable = { target_selected = 0 }

				#set_variable = { show_super_event_korea_nuke = 1 }

				set_variable = { key_hanging_selected = 1 }

				set_variable = { key_turned = 1}
				
				set_variable = { ack_selected = 0 }
				set_variable = { ack_authorize = 0 }
				set_variable = { activation_code = 0 }

				set_variable = { missile_selected = 0 }

				add_to_variable = { refresh_wmd_menu = 1}
			}
		}
		triggers = {
			tier1_active_visible = { has_country_flag = WMD_STRIKE_LEVEL_1 }
			tier2_active_visible = { has_country_flag = WMD_STRIKE_LEVEL_2 }
			tier3_active_visible = { has_country_flag = WMD_STRIKE_LEVEL_3 }
			chem_box_unchecked_click_enabled = {
				always = no
			}
			chem_box_checked_click_enabled = {
				always = no
			}
			nuke_box_checked_click_enabled = {
				always = no
			}
			nuke_box_unchecked_click_enabled = {
				always = no
			}
			tier3_click_enabled = {
				OR = {
					AND = {
						tag = USA
						has_country_flag = Jupiter_Misisles_Turkey
					}
					AND = {
						tag = SOV
						has_country_flag = Cuban_Missiles
					}
					has_tech = icbm1
				}
			}
		}
	}

	wmd_state_strike_list = {
        context_type = player_context
        window_name = "wmd_state_list"
		parent_window_name = "WMD_tab"

        dynamic_lists = {
            wmd_state_listing_grid = {
                array = ROOT.WarCrimeTargetList
                change_scope = yes
				entry_container = wmd_state_listing_entry
            }
        }
	}

	wmd_war_strike_list = {
        context_type = player_context
        window_name = "wmd_war_list"
		parent_window_name = "WMD_tab"
        dynamic_lists = {
            wmd_war_listing_grid = {
                array = ROOT.wmd_enemy_array
                change_scope = yes
				entry_container = wmd_war_listing_entry
            }
        }
		effects = {
			###################
			## enable button
			enemy_box_checked_click = { 
				set_variable = { THIS.checkmark = 1 }
				if = {
					limit = {
						check_variable = { ROOT.tier_1_selected = 1 }
					}

					###Very important below
					clear_array = ROOT.WarCrimeTargetList
					clear_array = ROOT.wmd_enemy_array
					
					ROOT= {
						distance_calculator_tier_1 = yes
					}
				}
				else_if = {
					limit = {
						check_variable = { ROOT.tier_2_selected = 1 }
					}
					###Very important below
					clear_array = ROOT.WarCrimeTargetList
					clear_array = ROOT.wmd_enemy_array
					
					ROOT= {
						distance_calculator_tier_2 = yes
					}
				}
				else = {
					###Very important below
					clear_array = ROOT.WarCrimeTargetList
					clear_array = ROOT.wmd_enemy_array
					
					ROOT= {
						distance_calculator = yes
					}
				}

				## check for missiles and nukes
				if = {
					limit = {
						ROOT = {
							has_equipment = {
								icbm_equipment > var:warhead_cost
							}
							check_variable = { num_of_nukes > nuke_cost }
						}
					}
					set_variable = { ROOT.missile_selected = 1}
				}
				else = {
					set_variable = { ROOT.missile_selected = 0}
				}
				####################

				#distance_calculator = yes
				#clear_array = ROOT.WarCrimeTargetList

				add_to_variable = { ROOT.refresh_wmd_menu = 1}
				add_to_variable = { ROOT.nations_selected = 1 }
			}

			###################
			## disable button
			enemy_box_unchecked_click = { 
				set_variable = { THIS.checkmark = 0 }
								
				if = {
					limit = {
						OR = {
							check_variable = { ROOT.tier_1_selected = 1 }
						}
					}

					###Very important below
					clear_array = ROOT.WarCrimeTargetList
					clear_array = ROOT.wmd_enemy_array
					set_variable = { ROOT.warhead_cost = 0 }
					set_variable = { ROOT.nuke_cost = 0 }
					
					ROOT= {
						distance_calculator_tier_1 = yes
					}
				}
				else_if = {
					limit = {
						check_variable = { ROOT.tier_2_selected = 1 }
					}
					###Very important below
					clear_array = ROOT.WarCrimeTargetList
					clear_array = ROOT.wmd_enemy_array
					set_variable = { ROOT.warhead_cost = 0 }
					
					ROOT= {
						distance_calculator_tier_2 = yes
					}
				}
				else = {
					###Very important below
					clear_array = ROOT.WarCrimeTargetList
					clear_array = ROOT.wmd_enemy_array
					set_variable = { ROOT.warhead_cost = 0 }
					
					ROOT= {
					distance_calculator = yes
					}
				}

				## check for missiles and nukes
				if = {
					limit = {
						ROOT = {
							has_equipment = {
								icbm_equipment > var:warhead_cost
							}
							check_variable = { num_of_nukes > nuke_cost }
						}
					}
					set_variable = { ROOT.missile_selected = 1}
				}
				else = {
					set_variable = { ROOT.missile_selected = 0}
				}
				####################

				#distance_calculator = yes
				#clear_array = ROOT.WarCrimeTargetList

				add_to_variable = { ROOT.refresh_wmd_menu = 1}
				subtract_from_variable = { ROOT.nations_selected = 1 }
			}
		}
		triggers = {
			enemy_box_checked_visible = {
				check_variable = { THIS.checkmark = 0 }
			}
			enemy_box_checked_click_enabled = {
				check_variable = { ROOT.target_selected = 1 }
			}
			enemy_box_unchecked_visible = {
				check_variable = { THIS.checkmark = 1 }
			}
			enemy_box_unchecked_click_enabled = {
				check_variable = { ROOT.target_selected = 1 }
			}
		}
    }
}
