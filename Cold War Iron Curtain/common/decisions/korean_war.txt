korean_war_prc_category = {
	withdraw_from_korea = {
		icon = generic_propaganda
		fire_only_once = yes
		allowed = {
			tag = PRC
		}
		ai_will_do = { factor = 100 }

		available = {
			PRC = {
				has_war_with = KOR
			}
			PRC = {
				NOT = {
					has_government = communism
				}
			}
			KOR = {
				has_full_control_of_state = 748
				has_full_control_of_state = 527
				has_full_control_of_state = 1205
				has_full_control_of_state = 747
				has_full_control_of_state = 745
			}
		}
		complete_effect = {
			PRC = {
				white_peace = KOR
				white_peace = USA
				white_peace = CHI
			}
			USA = {
				white_peace = PRC
				dismantle_faction = yes
			}
			CHI = {
				white_peace = PRC
				dismantle_faction = yes
			}
			KPA = {
				white_peace = KOR
			}
			KOR = {
				white_peace = PRC
				white_peace = KPA
				dismantle_faction = yes
				news_event = korea.12
				annex_country = { target = KPA transfer_troops = yes }
				set_global_flag = KOREA_CEASEFIRE_UN
			}
		}
	}

	cross_the_yalu_river = {
		icon = generic_propaganda
		fire_only_once = yes
		days_remove = 31
		allowed = {
			tag = PRC
		}
		ai_will_do = { factor = 100 }
		visible = {
			has_global_flag = korean_war_china_can_intervene
			has_global_flag = korean_war
			NOT = {
				has_country_flag = sent_reinforcements_to_korea1 #this will prevent the PRC spamming divisions to north korea
			}
		}
		available = {
			has_global_flag = korean_war_china_can_intervene
			has_global_flag = korean_war
		}
		complete_effect = {
			if = {
				limit = {
					has_country_flag = PRC_Soviet_Aligned
				}
				
				clr_global_flag = korean_war
				CHI = {
					declare_war_on = {
						target = KPA
						type = annex_everything
					}
				}
				PHI = {
					declare_war_on = {
						target = KPA
						type = annex_everything
					}
				}
				MON = {
					declare_war_on = {
						target = CHI
						type = annex_everything
					}
				}
				SIK = {
					declare_war_on = {
						target = CHI
						type = annex_everything
					}
				}
				PRC = {
					declare_war_on = {
						target = CHI
						type = annex_everything
					}
				}
				set_global_flag = asian_liberation_war
				PRC = {
					set_country_flag = PRC_SOV_faction_leader
					create_faction = "Peoples Liberation Front"
				}
				set_autonomy = {
					target = MON
					autonomy_state = autonomy_free
				}
				set_autonomy = {
					target = SIK
					autonomy_state = autonomy_free
				}
				set_autonomy = {
					target = PRC
					autonomy_state = autonomy_free
				}
				PRC = { add_to_faction = MON }
						add_to_war = { 
						targeted_alliance = MON
						enemy = KOR 
						hostility_reason = asked_to_join
				}
				PRC = { add_to_faction = KPA }
				PRC = { add_to_faction = SIK }
						add_to_war = { 
						targeted_alliance = MON
						enemy = KOR 
						hostility_reason = asked_to_join
				}
				
				hidden_effect = {
					SOV = { add_ideas = korean_war_com_sov }
					add_manpower = 100000
					every_country = {
							limit = {
								is_in_faction_with = SOV
							}
							add_ideas = korean_war_com
							add_ai_strategy = {
								type = send_volunteers_desire
								id = "KPA"
								value = 5000
							}
							add_ai_strategy = {
								type = befriend
								id = "KPA"
								value = 5000
							}
							add_ai_strategy = {
								type = send_volunteers_desire
								id = "MON"
								value = 5000
							}
							add_ai_strategy = {
								type = befriend
								id = "MON"
								value = 5000
							}
							add_ai_strategy = {
								type = send_volunteers_desire
								id = "SIK"
								value = 5000
							}
							add_ai_strategy = {
								type = befriend
								id = "SIK"
								value = 5000
							}
							add_ai_strategy = {
								type = send_volunteers_desire
								id = "PRC"
								value = 5000
							}
							add_ai_strategy = {
								type = befriend
								id = "PRC"
								value = 5000
							}
					}
				}
				KPA = { add_ideas = korean_war }
			}
			CHI = {
				create_faction = "Anti-Communist Bloc"
			}
			CHI = { add_to_faction = KOR }
			CHI = { add_to_faction = PHI }
			custom_effect_tooltip = PRC_communist_reinforcements_Korean_War_initial_TT
			hidden_effect = {
				KPA = { load_oob = PRC_communist_reinforcements_Korean_War_initial }
			}

			KPA = { add_to_faction = PRC }
			add_to_war = { 
				targeted_alliance = KPA 
				enemy = KOR 
				hostility_reason = asked_to_join
			}
			add_timed_idea = {
				idea = fight_against_the_imperialist1
				days = 70
			}
			KPA = {
				add_timed_idea = {
				idea = fight_against_the_imperialist1
				days = 70
				}
			}
			add_timed_idea = {
				idea = korean_war
				days = 1800
			}
			KOR = {
				add_timed_idea = {
					idea = unprepared_defenses
					days = 90
				}
			}
			USA = {
				add_timed_idea = {
					idea = unprepared_defenses
					days = 90
				}
				country_event = MacArthur_Dismissal.2
			}
			set_country_flag = KPA_INTERVENTION_1

			custom_effect_tooltip = PRC_crossing_the_yula_TT
			hidden_effect = {
				news_event = PRC_Focus.20
				load_oob = "PRC_crossing_the_yula"
			}
		}
		
		remove_effect = {
			PRC = {
				set_country_flag = sent_reinforcements_to_korea1
			}
		}
	}

	resist_the_americans_aid_to_SK = {
		icon = generic_propaganda
		cost = 50
		fire_only_once = yes
		days_remove = 31
		allowed = {
			tag = PRC
		}
		ai_will_do = { factor = 100 }
		visible = {
			has_global_flag = fall_of_pyeongyang
			has_country_flag = KPA_INTERVENTION_1
			NOT = {
				has_country_flag = sent_reinforcements_to_korea2 #this will prevent the PRC spamming divisions to north korea
			}
		}
		available = {
			has_global_flag = fall_of_pyeongyang
		}
		complete_effect = {
			custom_effect_tooltip = resist_the_americans_aid_to_SK_TT
			hidden_effect = {
				KPA = { load_oob = PRC_communist_reinforcements_Korean_War_2 }
			}
			set_country_flag = KPA_INTERVENTION_2
		}
		remove_effect = {
			PRC = {
				set_country_flag = sent_reinforcements_to_korea2
				clr_country_flag = sent_reinforcements_to_korea1
			}
		}
	}

	Keep_the_Capitalists_out_of_the_DMZ = {
		icon = generic_propaganda
		cost = 50
		fire_only_once = yes
		days_remove = 31
		allowed = {
			tag = PRC
		}
		ai_will_do = { factor = 100 }
		visible = {
			has_global_flag = fall_of_pyeongyang
			NOT = { has_country_flag = sent_reinforcements_to_korea3 } #this will prevent the PRC spamming divisions to north korea
			has_country_flag = KPA_INTERVENTION_2
		}
		available = {
			has_global_flag = fall_of_pyeongyang
		}
		complete_effect = {
			custom_effect_tooltip = Keep_the_Capitalists_out_of_the_DMZ_TT
			hidden_effect = {
				KPA = { load_oob = PRC_communist_reinforcements_Korean_War_4 }
			}
			set_country_flag = KPA_INTERVENTION_3
		}
		remove_effect = {
		PRC = {
			set_country_flag = sent_reinforcements_to_korea3
			clr_country_flag = sent_reinforcements_to_korea2
			}
		}
	}

	the_final_push = {
		icon = generic_propaganda
		cost = 50
		fire_only_once = yes
		days_remove = 31
		allowed = {
			tag = PRC
		}
		ai_will_do = { factor = 100 }
		visible = {
			has_global_flag = fall_of_pyeongyang
			NOT = { has_country_flag = sent_reinforcements_to_korea4 } #this will prevent the PRC spamming divisions to north korea
			has_country_flag = KPA_INTERVENTION_3
		}
		available = {
			has_global_flag = fall_of_pyeongyang
		}
		complete_effect = {
			custom_effect_tooltip = the_final_push_TT
			hidden_effect = {
				KPA = { load_oob = PRC_communist_reinforcements_Korean_War_3 }
			}
		}
		remove_effect = {
			PRC = {
				set_country_flag = sent_reinforcements_to_korea4
				clr_country_flag = sent_reinforcements_to_korea3
			}
		}
	}

	operation_ripper = {
		icon = generic_propaganda
		cost = 50
		fire_only_once = yes
		allowed = {
			tag = KOR
		}
		ai_will_do = {
			factor = 100
		}
		visible = {
			has_country_flag = KPA_INTERVENTION_1
			has_global_flag = third_battle_of_seoul
		}
		available = {
			has_country_flag = KPA_INTERVENTION_1
			has_global_flag = third_battle_of_seoul
		}
		
		complete_effect = {
			set_global_flag = operation_ripper
			news_event = conquest.103
		}
	}

	Korean_War_Ceasefire = {
		allowed = {
			always = no
		}
		visible = {
			tag = USA
		}
		available = {
			always = no
		}
		activation = {
			KPA = { 
				has_war_with = KOR
			}
			PRC = {
				has_war_with = KOR
			}
			NOT = { has_global_flag = KOREA_CEASEFIRE_UN }
			NOT = { has_global_flag = asian_liberation_war }
		}
		cancel_trigger = {
			OR = {
				NOT = { KOR = { has_war_with = KPA } }
				KPA = {
					has_war_with = CHI
					has_war_with = PHI
				}
			}
		}
		is_good = no

		selectable_mission = no
		days_mission_timeout = 1095

		timeout_effect = {
			if = {
				limit = {
					NOT = { has_global_flag = KOREA_CEASEFIRE_UN }
					KOR = { has_war_with = KPA } 
					NOT = { KPA = { has_capitulated = yes } }
				}
				KPA = {
					country_event = korea.16
					set_global_flag = KOREA_CEASEFIRE_UN
					white_peace = KOR
					white_peace = USA
					white_peace = ENG
					white_peace = AST
					white_peace = NZL
					white_peace = CAN
					white_peace = SAF
					white_peace = CHI
					PRC = {
						dismantle_faction = yes
						white_peace = CHI
					}
					USA = {
						white_peace = PRC
						white_peace = SOV
					}
					KOR = {
						dismantle_faction = yes
						white_peace = PRC
						white_peace = SOV
						white_peace = KPA
					}
					CHI = {
						dismantle_faction = yes
						white_peace = PRC
						white_peace = SOV
						white_peace = KPA
					}
					KOR = { transfer_state = 866 }
					SOV = { give_guarantee = KPA }
					PRC = { give_guarantee = KPA }
					USA = { give_guarantee = KOR }
					dismantle_faction = yes
					transfer_state = 525
					white_peace = KOR
				}
			}
			if = {
				limit = {
					NOT = { has_global_flag = KOREA_CEASEFIRE_UN }
					KOR = { has_war_with = KPA } 
					KPA = { has_capitulated = yes } 
				}
				USA = {
					white_peace = PRC
					dismantle_faction = yes
				}
				CHI = {
					white_peace = PRC
					dismantle_faction = yes
				}
				KPA = {
					white_peace = KOR
				}
				KOR = {
					white_peace = PRC
					white_peace = KPA
					dismantle_faction = yes
					news_event = korea.12
					annex_country = { target = KPA transfer_troops = yes }
					set_global_flag = KOREA_CEASEFIRE_UN
				}
			}
		}
		complete_effect = {
			if = {
				limit = {
					NOT = { has_global_flag = KOREA_CEASEFIRE_UN }
					KOR = { has_war_with = KPA } 
					NOT = { KPA = { has_capitulated = yes } }
				}
				KOR = {
					country_event = korea.21 
					set_global_flag = KOREA_CEASEFIRE_UN
				}
			}
			if = {
				limit = {
					NOT = { has_global_flag = KOREA_CEASEFIRE_UN }
					KOR = { has_war_with = KPA }
					KPA = { has_capitulated = yes }
				}
				KOR = {
					news_event = korea.27
					annex_country = { target = KPA transfer_troops = yes }
					set_global_flag = KOREA_CEASEFIRE_UN
				}
			}
		}
		ai_will_do = {
			factor = 0
		}
	}
}

korean_war_kpa_category = {	
	unify_korea = {
		icon = generic_industry
		allowed = {
			tag = KPA
		}
		visible = {
			original_tag = KPA
			country_exists = KOR
			OR = {
				AND = {
					OR = {
						has_government = communism
						has_government = maoism
					}
					has_country_flag = kor_war_clear
					date > 1950.6.1
					date < 1960.1.1					
				}
				AND = {
					is_ai = yes
					date > 1950.6.1
					date < 1960.1.1							
				}
			}

		}
		fire_only_once = yes
		cost = 0
		complete_effect = {
			korean_war_super_event = yes
			KOR = {
				every_owned_state = {
					remove_core_of = KPA
				}
			}
			USA = { activate_mission = Korean_War_Ceasefire }
			every_owned_state = {
				remove_core_of = KOR
			}
			add_named_threat = {
				threat = 30
				name = korean_War
			}
			country_event = korea.1
			add_ideas = korean_war
			add_ideas = kpa_korean_war
			add_timed_idea = {
				idea = take_the_south
				days = 25
			}
			create_faction = "People's Defense Coalition"
			set_global_flag = korean_war
			hidden_effect = {
				USA = { add_ideas = korean_war_un_usa }
				add_manpower = 100000
				every_country = {
					if = {
						limit = {
							OR = {
								tag = AST #does
								tag = CAN #doesn't
								tag = SAF #sends 
								tag = COL #does
								tag = SIA #sends
								tag = ETH #sends 
								tag = JAP #doesn't
								tag = CHI #sends
								tag = FRA #sends
								tag = ENG #sends
								tag = BEL #doesn't
								tag = HOL #doesn't
								tag = LUX #does
								tag = GRE #doesn't
								tag = TUR #doesn't
								tag = SPR #does
								tag = NZL
								tag = "PHI"
							}
						}
						add_ideas = korean_war_un
						add_ai_strategy = {
							type = send_volunteers_desire
							id = "KOR"
							value = 5000
						}
						add_ai_strategy = {
							type = support
							id = "KOR"
							value = 5000
						}
						add_ai_strategy = {
							type = befriend
							id = "KOR"
							value = 5000
						}
					}
				}
			}
			KOR = { add_ideas = korean_war }
		}
		ai_will_do = {
			factor = 1

		}
	}
}